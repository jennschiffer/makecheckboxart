(function(){
  // set these items:
  const rowCount = 40;
  const columnCount = 40;
  const initialDrawingJSONString = '[{"x":"31","y":"20"},{"x":"1","y":"8"},{"x":"2","y":"7"},{"x":"3","y":"6"},{"x":"4","y":"5"},{"x":"5","y":"4"},{"x":"6","y":"4"},{"x":"7","y":"5"},{"x":"8","y":"6"},{"x":"9","y":"7"},{"x":"10","y":"8"},{"x":"11","y":"9"},{"x":"12","y":"10"},{"x":"12","y":"11"},{"x":"13","y":"12"},{"x":"15","y":"12"},{"x":"14","y":"12"},{"x":"0","y":"13"},{"x":"1","y":"12"},{"x":"2","y":"11"},{"x":"3","y":"10"},{"x":"4","y":"9"},{"x":"5","y":"8"},{"x":"6","y":"9"},{"x":"6","y":"10"},{"x":"7","y":"12"},{"x":"7","y":"11"},{"x":"8","y":"13"},{"x":"9","y":"15"},{"x":"9","y":"16"},{"x":"16","y":"13"},{"x":"17","y":"13"},{"x":"18","y":"13"},{"x":"19","y":"13"},{"x":"20","y":"13"},{"x":"21","y":"13"},{"x":"22","y":"13"},{"x":"23","y":"13"},{"x":"24","y":"12"},{"x":"26","y":"12"},{"x":"25","y":"12"},{"x":"27","y":"12"},{"x":"28","y":"12"},{"x":"8","y":"14"},{"x":"8","y":"15"},{"x":"8","y":"16"},{"x":"7","y":"16"},{"x":"7","y":"15"},{"x":"6","y":"15"},{"x":"5","y":"15"},{"x":"4","y":"14"},{"x":"3","y":"14"},{"x":"2","y":"14"},{"x":"1","y":"14"},{"x":"0","y":"14"},{"x":"9","y":"17"},{"x":"9","y":"18"},{"x":"9","y":"19"},{"x":"9","y":"20"},{"x":"9","y":"22"},{"x":"9","y":"21"},{"x":"9","y":"23"},{"x":"8","y":"24"},{"x":"7","y":"25"},{"x":"6","y":"26"},{"x":"5","y":"27"},{"x":"4","y":"28"},{"x":"2","y":"29"},{"x":"3","y":"29"},{"x":"1","y":"28"},{"x":"0","y":"27"},{"x":"0","y":"26"},{"x":"1","y":"26"},{"x":"2","y":"26"},{"x":"3","y":"26"},{"x":"4","y":"25"},{"x":"5","y":"25"},{"x":"6","y":"25"},{"x":"7","y":"24"},{"x":"7","y":"23"},{"x":"8","y":"23"},{"x":"8","y":"22"},{"x":"7","y":"22"},{"x":"6","y":"22"},{"x":"5","y":"22"},{"x":"2","y":"22"},{"x":"1","y":"22"},{"x":"0","y":"22"},{"x":"0","y":"23"},{"x":"0","y":"24"},{"x":"0","y":"25"},{"x":"1","y":"25"},{"x":"2","y":"25"},{"x":"3","y":"25"},{"x":"1","y":"24"},{"x":"1","y":"23"},{"x":"2","y":"24"},{"x":"3","y":"23"},{"x":"2","y":"23"},{"x":"3","y":"24"},{"x":"4","y":"24"},{"x":"6","y":"24"},{"x":"5","y":"24"},{"x":"6","y":"23"},{"x":"5","y":"23"},{"x":"4","y":"23"},{"x":"4","y":"22"},{"x":"3","y":"22"},{"x":"0","y":"21"},{"x":"0","y":"20"},{"x":"0","y":"19"},{"x":"0","y":"18"},{"x":"0","y":"16"},{"x":"0","y":"17"},{"x":"0","y":"15"},{"x":"1","y":"16"},{"x":"1","y":"15"},{"x":"2","y":"15"},{"x":"2","y":"16"},{"x":"1","y":"17"},{"x":"2","y":"18"},{"x":"1","y":"18"},{"x":"1","y":"17"},{"x":"1","y":"19"},{"x":"2","y":"19"},{"x":"1","y":"20"},{"x":"2","y":"20"},{"x":"1","y":"21"},{"x":"2","y":"21"},{"x":"3","y":"21"},{"x":"3","y":"20"},{"x":"3","y":"18"},{"x":"3","y":"16"},{"x":"3","y":"15"},{"x":"4","y":"15"},{"x":"4","y":"16"},{"x":"3","y":"17"},{"x":"4","y":"17"},{"x":"4","y":"18"},{"x":"4","y":"19"},{"x":"3","y":"19"},{"x":"4","y":"20"},{"x":"4","y":"21"},{"x":"5","y":"21"},{"x":"5","y":"19"},{"x":"5","y":"18"},{"x":"5","y":"17"},{"x":"5","y":"16"},{"x":"6","y":"16"},{"x":"6","y":"17"},{"x":"6","y":"19"},{"x":"5","y":"20"},{"x":"6","y":"21"},{"x":"7","y":"21"},{"x":"8","y":"21"},{"x":"8","y":"20"},{"x":"7","y":"20"},{"x":"6","y":"20"},{"x":"7","y":"19"},{"x":"8","y":"19"},{"x":"8","y":"18"},{"x":"7","y":"18"},{"x":"6","y":"18"},{"x":"8","y":"17"},{"x":"7","y":"17"},{"x":"13","y":"11"},{"x":"14","y":"11"},{"x":"15","y":"11"},{"x":"16","y":"11"},{"x":"17","y":"11"},{"x":"16","y":"12"},{"x":"17","y":"12"},{"x":"18","y":"12"},{"x":"0","y":"31"},{"x":"1","y":"32"},{"x":"2","y":"33"},{"x":"3","y":"33"},{"x":"4","y":"32"},{"x":"5","y":"32"},{"x":"6","y":"31"},{"x":"7","y":"30"},{"x":"8","y":"30"},{"x":"9","y":"29"},{"x":"10","y":"29"},{"x":"11","y":"28"},{"x":"12","y":"27"},{"x":"13","y":"27"},{"x":"14","y":"27"},{"x":"15","y":"27"},{"x":"16","y":"27"},{"x":"17","y":"26"},{"x":"18","y":"26"},{"x":"19","y":"26"},{"x":"20","y":"26"},{"x":"21","y":"25"},{"x":"22","y":"25"},{"x":"23","y":"25"},{"x":"24","y":"26"},{"x":"25","y":"26"},{"x":"26","y":"27"},{"x":"27","y":"27"},{"x":"28","y":"27"},{"x":"29","y":"28"},{"x":"30","y":"28"},{"x":"31","y":"28"},{"x":"32","y":"29"},{"x":"33","y":"29"},{"x":"34","y":"29"},{"x":"35","y":"29"},{"x":"36","y":"29"},{"x":"37","y":"30"},{"x":"38","y":"30"},{"x":"39","y":"30"},{"x":"31","y":"12"},{"x":"30","y":"12"},{"x":"29","y":"12"},{"x":"32","y":"11"},{"x":"33","y":"11"},{"x":"34","y":"11"},{"x":"35","y":"11"},{"x":"36","y":"11"},{"x":"37","y":"11"},{"x":"38","y":"11"},{"x":"39","y":"11"},{"x":"33","y":"14"},{"x":"34","y":"15"},{"x":"34","y":"16"},{"x":"34","y":"17"},{"x":"34","y":"18"},{"x":"33","y":"19"},{"x":"28","y":"20"},{"x":"29","y":"20"},{"x":"30","y":"20"},{"x":"34","y":"19"},{"x":"33","y":"20"},{"x":"32","y":"20"},{"x":"34","y":"21"},{"x":"34","y":"22"},{"x":"34","y":"23"},{"x":"34","y":"24"},{"x":"35","y":"21"},{"x":"36","y":"22"},{"x":"37","y":"22"},{"x":"38","y":"23"},{"x":"39","y":"23"},{"x":"35","y":"19"},{"x":"37","y":"19"},{"x":"36","y":"19"},{"x":"38","y":"19"},{"x":"0","y":"9"},{"x":"2","y":"17"},{"x":"39","y":"19"}]';
  
  // edit the rest of this code ~*at your own risk*~
  const canvas = document.getElementById('grid');
  const jsonTextarea = document.getElementById('json');
  const checkboxesArray = JSON.parse(initialDrawingJSONString) || [];
  
  const onCanvasClick = function(e) {
    var e = window.e || e;
    if (e.target.tagName !== 'INPUT') {
      return;
    }
    
    const posArr = e.target.getAttribute('data-position').split('_');
    if (e.target.checked) {
      checkboxesArray.push({
        x: posArr[0],
        y: posArr[1],
      });
    } else {
      const removeIndex = checkboxesArray.indexOf({
        x: posArr[0],
        y: posArr[1],
      });
      checkboxesArray.splice(removeIndex, 1);
    }
    console.log(JSON.stringify(checkboxesArray))
    jsonTextarea.value = JSON.stringify(checkboxesArray);
  }
  
  const initGrid = function(rows, cols){
    for (let i = 0; i < rows; i++) {
      const newRow = document.createElement('div');
      for (let j = 0; j < cols; j++) {
        const newCheck = document.createElement('input');
        newCheck.setAttribute('type', 'checkbox');
        newCheck.setAttribute('data-position', `${i}_${j}`)
        checkboxesArray.forEach(({x, y}) => {
          if ( x == i && y == j ) {
            newCheck.checked = true;
          }
        });
        newRow.appendChild(newCheck);
      }
      canvas.appendChild(newRow);
    }
  }
  
  initGrid(rowCount, columnCount);
  jsonTextarea.value = initialDrawingJSONString || ''

  // listen for clicks 2 draw
  if (canvas.addEventListener) {
    canvas.addEventListener('click', onCanvasClick, false);
  }
  else {
    canvas.attachEvent('onclick', onCanvasClick);
  }
})()
